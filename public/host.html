<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Killer Game Host</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Host Panel</h1>

<div class="controls">
  <input id="playerName" placeholder="Enter player name">
  <button id="addPlayerBtn">Add Player</button>
  <button id="startGameBtn">Start Game</button>
  <button id="startVotingBtn">Start Voting</button>
  <button id="endGameBtn">End Game</button>
</div>

<h2>Players:</h2>
<ul id="playerList"></ul>

<h2>Player Links:</h2>
<ul id="playerLinks"></ul>

<h2>Voting Results:</h2>
<ul id="voteResults"></ul>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const playerListEl = document.getElementById("playerList");
const playerLinksEl = document.getElementById("playerLinks");
const voteResultsEl = document.getElementById("voteResults");
const playerNameInput = document.getElementById("playerName");
const addPlayerBtn = document.getElementById("addPlayerBtn");
const startGameBtn = document.getElementById("startGameBtn");
const startVotingBtn = document.getElementById("startVotingBtn");
const endGameBtn = document.getElementById("endGameBtn");

let roles = {};

// Add player
addPlayerBtn.addEventListener("click", () => {
  const name = playerNameInput.value.trim();
  if(name){
    socket.emit("addPlayer", name);
    playerNameInput.value = "";
  }
});

// Start game
startGameBtn.addEventListener("click", () => socket.emit("startGame"));

// End game
endGameBtn.addEventListener("click", () => socket.emit("endGame"));

// Start voting
startVotingBtn.addEventListener("click", () => socket.emit("startVoting"));

// Update player list
socket.on("updatePlayers", (players, alive) => {
  playerListEl.innerHTML = "";
  players.forEach(name => {
    const li = document.createElement("li");
    li.textContent = name;
    if(alive[name]===false) li.style.textDecoration="line-through";
    playerListEl.appendChild(li);
  });
});

// Receive token link
socket.on("playerToken", ({name, token}) => {
  const li = document.createElement("li");
  li.innerHTML = `${name}: <a href="/player.html?token=${token}" target="_blank">Link</a>`;
  playerLinksEl.appendChild(li);
});

// Game started
socket.on("gameStarted", (r) => {
  roles = r;
  alert("Game started! Roles assigned.");
});

// Game ended
socket.on("gameEnded", () => {
  roles={};
  playerListEl.innerHTML="";
  playerLinksEl.innerHTML="";
  voteResultsEl.innerHTML="";
  alert("Game ended!");
});

// Player died
socket.on("playerDied", (name) => {
  const items = document.querySelectorAll("#playerList li");
  items.forEach(li => { if(li.textContent.includes(name)) li.style.textDecoration="line-through"; });
});

// Voting result
socket.on("votingResult", ({eliminated, role}) => {
  const li = document.createElement("li");
  li.textContent = `${eliminated} got eliminated. Role: ${role}`;
  voteResultsEl.appendChild(li);
});
</script>
</body>
</html>