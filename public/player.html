<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Killer Game Player</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Player Panel</h1>

<p>Your role: <span id="role">Unknown</span></p>
<button id="markDeadBtn">Mark Dead</button>

<h2>Voting:</h2>
<ul id="voteList"></ul>
<div id="voteButtons"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const roleEl = document.getElementById("role");
const markDeadBtn = document.getElementById("markDeadBtn");
const voteListEl = document.getElementById("voteList");
const voteButtonsDiv = document.getElementById("voteButtons");

let playerName = null;
let alivePlayers = [];
let votingStarted = false;

// Get token
const token = new URLSearchParams(window.location.search).get("token");
if(!token) alert("Invalid link!");
else socket.emit("getPlayerName", token);

// Receive player name
socket.on("playerNameAssigned", (name)=>{
  if(name==="Unknown"){ alert("Invalid link!"); return; }
  playerName=name;
  alert("Welcome "+playerName);
});

// Receive game roles
socket.on("gameStarted", (roles)=>{
  if(playerName && roles[playerName]) roleEl.textContent = roles[playerName];
});

// Mark dead
markDeadBtn.addEventListener("click", ()=>{
  if(playerName && roleEl.textContent!=="Killer"){
    socket.emit("markDead", playerName);
  } else alert("Killer cannot mark self dead");
});

// Player died
socket.on("playerDied", (name)=>alert(name+" is dead!"));

// Game ended
socket.on("gameEnded", ()=>{
  roleEl.textContent="Unknown";
  alert("Game ended!");
});

// Voting started
socket.on("votingStarted", (alive)=>{
  votingStarted=true;
  alivePlayers = Object.keys(alive).filter(p=>alive[p] && p!==playerName);
  voteButtonsDiv.innerHTML="";
  alivePlayers.forEach(p=>{
    const btn = document.createElement("button");
    btn.textContent = "Vote: "+p;
    btn.addEventListener("click", ()=>{
      socket.emit("vote",{voter:playerName,voted:p});
      voteButtonsDiv.innerHTML="";
      alert("Voted for "+p);
    });
    voteButtonsDiv.appendChild(btn);
  });
});

// Voting result
socket.on("votingResult", ({eliminated, role})=>{
  alert(eliminated+" got eliminated! Role: "+role);
});
</script>
</body>
</html>