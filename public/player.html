
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Killer Game • Player</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>🎮 Killer Game</h1>

    <h2 id="roleDisplay">Role: ?</h2>
    <button id="toggleDeadBtn">💀 Mark Dead / ❤️ Alive</button>

    <div id="votingArea" style="display:none;">
      <h3>Vote to eliminate:</h3>
      <div id="voteOptions"></div>
    </div>
  </div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const params = new URLSearchParams(window.location.search);
  const token = params.get("token");

  const roleDisplay = document.getElementById("roleDisplay");
  const toggleDeadBtn = document.getElementById("toggleDeadBtn");
  const votingArea = document.getElementById("votingArea");
  const voteOptions = document.getElementById("voteOptions");

  // Join game automatically
  socket.emit("joinWithToken", token);

  toggleDeadBtn.onclick = () => socket.emit("toggleDead", token);

  socket.on("yourRole", (role) => {
    roleDisplay.innerText = `Role: ${role}`;
  });

  socket.on("playerDeadMessage", (name) => {
    alert(`${name} is dead!`);
  });

  socket.on("votingStarted", () => {
    votingArea.style.display = "block";
  });

  socket.on("updatePlayers", (players) => {
    voteOptions.innerHTML = players
      .filter(p => p.alive)
      .map(p => `<button onclick="vote('${p.name}')">${p.name}</button>`)
      .join('');
  });

  function vote(name) {
    socket.emit("castVote", { voterToken: token, targetName: name });
    votingArea.style.display = "none";
  }

  socket.on("votingResult", (data) => {
    votingArea.style.display = "none";
    alert(`${data.name} was a ${data.role}`);
  });
</script>
</body>
</html>