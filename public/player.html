<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Killer Game Player</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Player Panel</h1>

<p>Your role: <span id="role">Unknown</span></p>
<button id="markDeadBtn">Mark Dead</button>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const roleEl = document.getElementById("role");
const markDeadBtn = document.getElementById("markDeadBtn");

let playerName = null;

// Get token from URL
const urlParams = new URLSearchParams(window.location.search);
const token = urlParams.get("token");

if(!token){
  alert("Invalid link!");
} else {
  socket.emit("getPlayerName", token);
}

// Receive assigned player name
socket.on("playerNameAssigned", (name) => {
  if(name==="Unknown"){ alert("Invalid link!"); return; }
  playerName = name;
  alert("Welcome " + playerName);
});

// Receive game started roles
socket.on("gameStarted", (roles) => {
  if(playerName && roles[playerName]){
    roleEl.textContent = roles[playerName];
  }
});

// Mark self dead
markDeadBtn.addEventListener("click", () => {
  if(playerName){
    socket.emit("markDead", playerName);
  }
});

// Notify when someone dies
socket.on("playerDied", (name) => alert(name + " is dead!"));

// Game ended
socket.on("gameEnded", () => {
  roleEl.textContent = "Unknown";
  alert("Game ended!");
});
</script>
</body>
</html>